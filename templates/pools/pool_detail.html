{% extends 'base.html' %}
{% load static %}
{% load pool_extras %}

{% block title %}{{ pool.name }} | Bolão Online{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pools.css' %}">
{% endblock %}
{% block content %}
<!-- Skip to main content -->
<a href="#pool-detail-main" class="skip-link">Pular para conteúdo do bolão</a>

<!-- Pool Header com Cover Image -->
<header class="pool-detail-header" role="banner">
    <div class="pool-detail-content">
        <div class="pool-logo">
            {% if pool.competition.logo %}
                <img src="{{ pool.competition.logo.url }}" alt="Logo {{ pool.competition.name }}" class="rounded-circle" style="width: 60px; height: 60px; object-fit: contain;">
            {% else %}
                <i class="fas fa-trophy fa-2x" aria-hidden="true"></i>
            {% endif %}
        </div>
        
        <h1 class="pool-detail-title">{{ pool.name }}</h1>
        <p class="pool-detail-subtitle">{{ pool.competition.name }}</p>
        
        <div class="pool-stats-header" role="list" aria-label="Estatísticas do bolão">
            <div class="pool-stat-item" role="listitem">
                <span class="pool-stat-number">{{ participants_count }}</span>
                <span class="pool-stat-label">Participantes</span>
            </div>
            <div class="pool-stat-item" role="listitem">
                <span class="pool-stat-number">{{ total_points|default:0 }}</span>
                <span class="pool-stat-label">Pontos Totais</span>
            </div>
            <div class="pool-stat-item" role="listitem">
                <span class="pool-stat-number">{{ upcoming_matches|length }}</span>
                <span class="pool-stat-label">Próximas</span>
            </div>
            <div class="pool-stat-item" role="listitem">
                <span class="pool-stat-number">{{ pool_stats.progress_percentage|floatformat:0 }}%</span>
                <span class="pool-stat-label">Progresso</span>
            </div>
        </div>
    </div>
    
    <!-- Status Badge -->
    <div class="position-absolute top-0 end-0 m-3">
        <span class="pool-status-badge status-{{ pool.status }}" role="status">
            {% if pool.status == 'open' %}
                <i class="fas fa-unlock me-1" aria-hidden="true"></i>Aberto
            {% elif pool.status == 'closed' %}
                <i class="fas fa-lock me-1" aria-hidden="true"></i>Fechado
            {% else %}
                <i class="fas fa-flag-checkered me-1" aria-hidden="true"></i>Finalizado
            {% endif %}
        </span>
    </div>
    
    <!-- Owner Actions -->
    {% if is_owner %}
    <div class="position-absolute top-0 start-0 m-3">
        <div class="dropdown">
            <button class="btn btn-light btn-sm dropdown-toggle" type="button" id="poolActionsDropdown" data-bs-toggle="dropdown" aria-label="Menu de gerenciamento do bolão" aria-haspopup="true" aria-expanded="false">
                <i class="fas fa-cog me-1" aria-hidden="true"></i> Gerenciar
            </button>
            <ul class="dropdown-menu" aria-labelledby="poolActionsDropdown">
                <li><a class="dropdown-item" href="{% url 'pools:update' pool.slug %}">
                    <i class="fas fa-edit me-2" aria-hidden="true"></i> Editar Bolão
                </a></li>
                <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#inviteModal">
                    <i class="fas fa-user-plus me-2" aria-hidden="true"></i> Convidar Participantes
                </a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item text-danger" href="#" onclick="confirmDelete()">
                    <i class="fas fa-trash-alt me-2" aria-hidden="true"></i> Excluir Bolão
                </a></li>
            </ul>
        </div>
    </div>
    {% endif %}
</header>

<!-- Main Content -->
<main id="pool-detail-main" class="container-fluid">
    <!-- Navigation Tabs -->
    <nav>
        <ul class="nav pool-tabs" id="poolTabs" role="tablist" aria-label="Navegação do bolão">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="ranking-tab" data-bs-toggle="tab" data-bs-target="#ranking" type="button" role="tab" aria-controls="ranking" aria-selected="true">
                    <i class="fas fa-trophy" aria-hidden="true"></i> Ranking
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="bets-tab" data-bs-toggle="tab" data-bs-target="#bets" type="button" role="tab" aria-controls="bets" aria-selected="false">
                    <i class="fas fa-dice" aria-hidden="true"></i> Minhas Apostas
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="matches-tab" data-bs-toggle="tab" data-bs-target="#matches" type="button" role="tab" aria-controls="matches" aria-selected="false">
                    <i class="fas fa-calendar-alt" aria-hidden="true"></i> Próximas Partidas
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="rules-tab" data-bs-toggle="tab" data-bs-target="#rules" type="button" role="tab" aria-controls="rules" aria-selected="false">
                    <i class="fas fa-book" aria-hidden="true"></i> Regras
                </button>
            </li>
        </ul>
    </nav>

    <!-- Tab Content -->
    <div class="tab-content pool-tab-content" id="poolTabsContent">
        <!-- Ranking Tab -->
        <div class="tab-pane fade show active" id="ranking" role="tabpanel" aria-labelledby="ranking-tab">
            <div class="ranking-table-wrapper">
                <table class="table ranking-table table-hover">
                    <thead>
                        <tr>
                            <th scope="col" style="width: 80px;">Posição</th>
                            <th scope="col">Participante</th>
                            <th scope="col" style="width: 100px;" class="text-center">Pontos</th>
                            <th scope="col" style="width: 120px;" class="text-center">Aproveitamento</th>
                            <th scope="col" style="width: 100px;" class="text-center">Apostas</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for ranking_item in ranking_data %}
                        <tr {% if ranking_item.is_current_user %}class="current-user" aria-current="true"{% endif %}>
                            <td>
                                <div class="position-badge 
                                    {% if ranking_item.position == 1 %}gold
                                    {% elif ranking_item.position == 2 %}silver
                                    {% elif ranking_item.position == 3 %}bronze
                                    {% else %}other{% endif %}" role="status" aria-label="Posição {{ ranking_item.position }}">
                                    {% if ranking_item.position <= 3 %}
                                        <i class="fas fa-trophy" aria-hidden="true"></i>
                                    {% else %}
                                        {{ ranking_item.position }}
                                    {% endif %}
                                </div>
                            </td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="user-avatar" aria-hidden="true">
                                        {{ ranking_item.participation.user.username|first|upper }}
                                    </div>
                                    <div class="user-info">
                                        <h3 class="h6 mb-0">{{ ranking_item.participation.user.username }}</h3>
                                        <small>
                                            {% if ranking_item.participation.user == pool.owner %}
                                                <i class="fas fa-crown text-warning" aria-hidden="true"></i> Criador
                                            {% elif ranking_item.is_current_user %}
                                                <i class="fas fa-user text-primary" aria-hidden="true"></i> Você
                                            {% endif %}
                                        </small>
                                    </div>
                                </div>
                            </td>
                            <td class="text-center">
                                <strong class="fs-5">{{ ranking_item.participation.points|default:0 }}</strong>
                            </td>
                            <td class="text-center">
                                <div class="progress-custom" role="progressbar" aria-valuenow="{{ ranking_item.participation.accuracy|default:0 }}" aria-valuemin="0" aria-valuemax="100">
                                    <div class="progress-bar" style="width: {{ ranking_item.participation.accuracy|default:0 }}%"></div>
                                </div>
                                <small>{{ ranking_item.participation.accuracy|default:0|floatformat:1 }}%</small>
                            </td>
                            <td class="text-center">
                                <span class="badge bg-secondary">{{ ranking_item.participation.total_bets|default:0 }}</span>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center py-5">
                                <i class="fas fa-users fa-3x text-muted mb-3" aria-hidden="true"></i>
                                <p class="text-muted">Nenhum participante ainda</p>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Minhas Apostas Tab -->
        <div class="tab-pane fade" id="bets" role="tabpanel">
            {% if is_participant %}
                <div class="row">
                    <div class="col-md-8">
                        <h5 class="mb-3">Suas Apostas</h5>
                        {% if user_bets %}
                            <div class="timeline-custom">
                                {% for bet in user_bets %}
                                <div class="timeline-item">
                                    <div class="timeline-card">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <div>
                                                <div class="match-teams">
                                                    {{ bet.match.home_team.name }} vs {{ bet.match.away_team.name }}
                                                </div>
                                                <div class="match-info">
                                                    <div class="match-info-item">
                                                        <i class="fas fa-calendar"></i>
                                                        {{ bet.match.start_time|date:"d/m/Y" }}
                                                    </div>
                                                    <div class="match-info-item">
                                                        <i class="fas fa-clock"></i>
                                                        {{ bet.match.start_time|date:"H:i" }}
                                                    </div>
                                                    <div class="match-info-item">
                                                        <i class="fas fa-map-marker-alt"></i>
                                                        {{ bet.match.venue|default:"Estádio TBD" }}
                                                    </div>
                                                </div>
                                                <div class="d-flex align-items-center gap-3">
                                                    <div class="bet-prediction">
                                                        <strong>Sua aposta:</strong>
                                                        <span class="fs-5 mx-2">{{ bet.home_score_bet }}</span>
                                                        <span class="vs-separator">×</span>
                                                        <span class="fs-5 mx-2">{{ bet.away_score_bet }}</span>
                                                    </div>
                                                    {% if bet.match.finished %}
                                                        <div class="match-result">
                                                            <strong>Resultado:</strong>
                                                            <span class="fs-5 mx-2">{{ bet.match.home_score }}</span>
                                                            <span class="vs-separator">×</span>
                                                            <span class="fs-5 mx-2">{{ bet.match.away_score }}</span>
                                                        </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="text-end">
                                                {% if bet.match.finished %}
                                                    <div class="badge bg-success fs-6 mb-2">
                                                        +{{ bet.points_earned|default:0 }} pts
                                                    </div>
                                                {% else %}
                                                    <span class="bet-status pending">
                                                        <i class="fas fa-clock me-1"></i>Aguardando
                                                    </span>
                                                {% endif %}
                                                
                                                {% if not bet.match.finished and bet.match.start_time > now %}
                                                    <div class="mt-2">
                                                        <button class="btn btn-sm btn-outline-primary" onclick="editBet('{{ bet.match.id }}')">
                                                            <i class="fas fa-edit"></i> Editar
                                                        </button>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="text-center py-5">
                                <i class="fas fa-dice fa-4x text-muted mb-3"></i>
                                <h4>Nenhuma aposta ainda</h4>
                                <p class="text-muted">Faça sua primeira aposta nas próximas partidas!</p>
                                <button class="btn btn-primary" data-bs-toggle="tab" data-bs-target="#matches">
                                    <i class="fas fa-plus me-2"></i>Ver Próximas Partidas
                                </button>
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="col-md-4">
                        <h5 class="mb-3">Suas Estatísticas</h5>
                        <div class="card">
                            <div class="card-body">
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between mb-1">
                                        <span>Total de Pontos</span>
                                        <strong>{{ user_stats.total_points|default:0 }}</strong>
                                    </div>
                                    <div class="progress-custom">
                                        <div class="progress-bar" style="width: {{ user_stats.accuracy_rate|default:0 }}%"></div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span>Apostas Feitas</span>
                                        <strong>{{ user_stats.total_bets|default:0 }}</strong>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span>Apostas Corretas</span>
                                        <strong>{{ user_stats.correct_bets|default:0 }}</strong>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span>Taxa de Acerto</span>
                                        <strong>{{ user_stats.accuracy_rate|default:0|floatformat:1 }}%</strong>
                                    </div>
                                </div>
                                
                                <div class="mb-0">
                                    <div class="d-flex justify-content-between">
                                        <span>Média de Pontos</span>
                                        <strong>{{ user_stats.average_points|default:0|floatformat:1 }}</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-lock fa-4x text-muted mb-3"></i>
                    <h4>Participe para ver suas apostas</h4>
                    <p class="text-muted">Junte-se ao bolão para começar a apostar!</p>
                    {% if pool.status == 'open' %}
                        <a href="{% url 'pools:join' pool.slug %}" class="btn btn-primary">
                            <i class="fas fa-plus-circle me-2"></i>Participar do Bolão
                        </a>
                    {% endif %}
                </div>
            {% endif %}
        </div>

        <!-- Próximas Partidas Tab -->
        <div class="tab-pane fade" id="matches" role="tabpanel">
            <h5 class="mb-4">Próximas Partidas</h5>
            {% if upcoming_matches %}
                <div class="timeline-custom">
                    {% for match in upcoming_matches %}
                    <div class="timeline-item">
                        <div class="timeline-card">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="flex-grow-1">
                                    <div class="match-teams">
                                        {{ match.home_team.name }} vs {{ match.away_team.name }}
                                    </div>
                                    <div class="match-info">
                                        <div class="match-info-item">
                                            <i class="fas fa-calendar"></i>
                                            {{ match.start_time|date:"d/m/Y" }}
                                        </div>
                                        <div class="match-info-item">
                                            <i class="fas fa-clock"></i>
                                            {{ match.start_time|date:"H:i" }}
                                        </div>
                                        <div class="match-info-item">
                                            <i class="fas fa-map-marker-alt"></i>
                                            {{ match.venue|default:"Estádio TBD" }}
                                        </div>
                                    </div>
                                    
                                    {% if match.id in user_bets_dict %}
                                        {% with bet=user_bets_dict|get_item:match.id %}
                                        <div class="mt-2">
                                            <span class="bet-status confirmed">
                                                <i class="fas fa-check me-1"></i>
                                                Aposta: {{ bet.home_score_bet }} × {{ bet.away_score_bet }}
                                            </span>
                                        </div>
                                        {% endwith %}
                                    {% endif %}
                                </div>
                                
                                <div class="text-end">
                                    {% if is_participant and match.start_time > now %}
                                        {% if match.id in user_bets_dict %}
                                            <button class="btn btn-outline-primary btn-sm" onclick="editBet('{{ match.id }}')">
                                                <i class="fas fa-edit me-1"></i>Editar Aposta
                                            </button>
                                        {% else %}
                                            <button class="btn btn-primary btn-sm" onclick="makeBet('{{ match.id }}')">
                                                <i class="fas fa-plus me-1"></i>Fazer Aposta
                                            </button>
                                        {% endif %}
                                    {% elif match.start_time <= now %}
                                        <span class="bet-status missed">
                                            <i class="fas fa-times me-1"></i>Prazo Encerrado
                                        </span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-calendar-times fa-4x text-muted mb-3"></i>
                    <h4>Nenhuma partida programada</h4>
                    <p class="text-muted">As próximas partidas aparecerão aqui em breve.</p>
                </div>
            {% endif %}
        </div>

        <!-- Regras Tab -->
        <div class="tab-pane fade" id="rules" role="tabpanel">
            <div class="row">
                <div class="col-md-8">
                    <h5 class="mb-4">Regras do Bolão</h5>
                    
                    <div class="card mb-4">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-info-circle me-2"></i>Informações Básicas</h6>
                        </div>
                        <div class="card-body">
                            {% if pool.description %}
                                <p>{{ pool.description|linebreaks }}</p>
                            {% else %}
                                <p>Bolão da competição {{ pool.competition.name }}.</p>
                            {% endif %}
                            
                            <div class="row g-3">
                                <div class="col-sm-6">
                                    <strong>Taxa de Entrada:</strong>
                                    {% if pool.entry_fee > 0 %}
                                        R$ {{ pool.entry_fee|floatformat:2 }}
                                    {% else %}
                                        Gratuito
                                    {% endif %}
                                </div>
                                <div class="col-sm-6">
                                    <strong>Visibilidade:</strong>
                                    {{ pool.get_visibility_display }}
                                </div>
                                <div class="col-sm-6">
                                    <strong>Criado em:</strong>
                                    {{ pool.created_at|date:"d/m/Y H:i" }}
                                </div>
                                <div class="col-sm-6">
                                    <strong>Criado por:</strong>
                                    {{ pool.owner.username }}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card mb-4">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-calculator me-2"></i>Sistema de Pontuação</h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="d-flex justify-content-between align-items-center p-3 bg-success bg-opacity-10 rounded">
                                        <div>
                                            <strong>Placar Exato</strong>
                                            <br><small class="text-muted">Acertar o placar completo</small>
                                        </div>
                                        <span class="badge bg-success fs-6">10 pontos</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="d-flex justify-content-between align-items-center p-3 bg-primary bg-opacity-10 rounded">
                                        <div>
                                            <strong>Saldo de Gols</strong>
                                            <br><small class="text-muted">Acertar diferença e vencedor</small>
                                        </div>
                                        <span class="badge bg-primary fs-6">5 pontos</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="d-flex justify-content-between align-items-center p-3 bg-warning bg-opacity-10 rounded">
                                        <div>
                                            <strong>Vencedor</strong>
                                            <br><small class="text-muted">Acertar apenas o vencedor</small>
                                        </div>
                                        <span class="badge bg-warning fs-6">3 pontos</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="d-flex justify-content-between align-items-center p-3 bg-danger bg-opacity-10 rounded">
                                        <div>
                                            <strong>Erro</strong>
                                            <br><small class="text-muted">Não acertar nada</small>
                                        </div>
                                        <span class="badge bg-danger fs-6">0 pontos</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-gavel me-2"></i>Regras Gerais</h6>
                        </div>
                        <div class="card-body">
                            <ul class="list-unstyled">
                                <li class="mb-2">
                                    <i class="fas fa-check text-success me-2"></i>
                                    As apostas devem ser feitas antes do início de cada partida
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-check text-success me-2"></i>
                                    Você pode editar suas apostas até 30 minutos antes do jogo
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-check text-success me-2"></i>
                                    Os pontos são calculados automaticamente após o resultado
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-check text-success me-2"></i>
                                    O ranking é atualizado em tempo real
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-check text-success me-2"></i>
                                    Em caso de empate, todos os participantes empatados recebem a mesma colocação
                                </li>
                                <li class="mb-0">
                                    <i class="fas fa-check text-success me-2"></i>
                                    O vencedor é determinado pela maior pontuação total
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Estatísticas do Bolão</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span>Progresso</span>
                                    <span>{{ pool_stats.progress_percentage|floatformat:0 }}%</span>
                                </div>
                                <div class="progress-custom">
                                    <div class="progress-bar" style="width: {{ pool_stats.progress_percentage }}%"></div>
                                </div>
                                <small class="text-muted">{{ pool_stats.finished_matches }} de {{ pool_stats.total_matches }} partidas</small>
                            </div>
                            
                            <hr>
                            
                            <div class="mb-2">
                                <div class="d-flex justify-content-between">
                                    <span>Total de Participantes</span>
                                    <strong>{{ participants_count }}</strong>
                                </div>
                            </div>
                            
                            <div class="mb-2">
                                <div class="d-flex justify-content-between">
                                    <span>Partidas Restantes</span>
                                    <strong>{{ pool_stats.remaining_matches }}</strong>
                                </div>
                            </div>
                            
                            <div class="mb-2">
                                <div class="d-flex justify-content-between">
                                    <span>Apostas Totais</span>
                                    <strong>{{ total_bets|default:0 }}</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Floating Action Button -->
{% if is_participant and upcoming_matches %}
<button class="floating-bet-btn" onclick="showQuickBetModal()" data-bs-toggle="tooltip" data-bs-placement="left" title="Fazer Aposta Rápida" aria-label="Fazer aposta rápida">
    <i class="fas fa-dice" aria-hidden="true"></i>
</button>
{% endif %}

<!-- Modal de Aposta Rápida -->
<div class="modal fade pool-modal" id="quickBetModal" tabindex="-1" aria-labelledby="quickBetModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title h5" id="quickBetModalLabel">
                    <i class="fas fa-dice me-2" aria-hidden="true"></i>Fazer Aposta
                </h2>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body" id="quickBetContent">
                <!-- Conteúdo carregado dinamicamente -->
                <div class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Carregando...</span>
                    </div>
                    <p class="mt-2">Carregando partidas...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Convite -->
{% if is_owner %}
<div class="modal fade pool-modal" id="inviteModal" tabindex="-1" aria-labelledby="inviteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title h5" id="inviteModalLabel">
                    <i class="fas fa-user-plus me-2" aria-hidden="true"></i>Convidar Participantes
                </h2>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="inviteLink" class="form-label">Link de Convite</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="inviteLink" value="{{ request.build_absolute_uri }}" readonly aria-label="Link de convite do bolão">
                        <button class="btn btn-outline-secondary" onclick="copyInviteLink()" aria-label="Copiar link de convite">
                            <i class="fas fa-copy" aria-hidden="true"></i>
                        </button>
                    </div>
                    <small class="form-text text-muted">Compartilhe este link para que outros possam participar</small>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Compartilhar via:</label>
                    <div class="d-grid gap-2">
                        <a href="https://wa.me/?text=Participe do meu bolão '{{ pool.name }}' - {{ request.build_absolute_uri|urlencode }}" 
                           target="_blank" rel="noopener noreferrer" class="btn btn-success" aria-label="Compartilhar via WhatsApp">
                            <i class="fab fa-whatsapp me-2" aria-hidden="true"></i>WhatsApp
                        </a>
                        <a href="https://t.me/share/url?url={{ request.build_absolute_uri|urlencode }}&text=Participe do bolão {{ pool.name }}" 
                           target="_blank" rel="noopener noreferrer" class="btn btn-info" aria-label="Compartilhar via Telegram">
                            <i class="fab fa-telegram me-2" aria-hidden="true"></i>Telegram
                        </a>
                        <a href="mailto:?subject=Convite para o bolão {{ pool.name }}&body=Olá!%0A%0AConvido você a participar do meu bolão '{{ pool.name }}'.%0A%0AClique no link para participar: {{ request.build_absolute_uri }}" 
                           class="btn btn-secondary" aria-label="Compartilhar via Email">
                            <i class="fas fa-envelope me-2" aria-hidden="true"></i>Email
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Inicializar tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
    
    // Persistir tab ativa no localStorage
    const lastActiveTab = localStorage.getItem('activePoolTab');
    if (lastActiveTab) {
        const tabTrigger = document.querySelector(`[data-bs-target="${lastActiveTab}"]`);
        if (tabTrigger) {
            const tab = new bootstrap.Tab(tabTrigger);
            tab.show();
        }
    }
    
    // Salvar tab ativa quando mudada
    document.querySelectorAll('[data-bs-toggle="tab"]').forEach(function(tabEl) {
        tabEl.addEventListener('shown.bs.tab', function (event) {
            localStorage.setItem('activePoolTab', event.target.getAttribute('data-bs-target'));
        });
    });
});

// Função para copiar link de convite
function copyInviteLink() {
    const copyText = document.getElementById('inviteLink');
    copyText.select();
    copyText.setSelectionRange(0, 99999);
    navigator.clipboard.writeText(copyText.value).then(function() {
        // Feedback visual
        const button = event.target.closest('button');
        const originalHtml = button.innerHTML;
        button.innerHTML = '<i class="fas fa-check"></i>';
        button.classList.add('btn-success');
        button.classList.remove('btn-outline-secondary');
        
        setTimeout(function() {
            button.innerHTML = originalHtml;
            button.classList.remove('btn-success');
            button.classList.add('btn-outline-secondary');
        }, 2000);
    }).catch(function() {
        // Fallback para navegadores mais antigos
        document.execCommand("copy");
    });
}

// Função para mostrar modal de aposta rápida
function showQuickBetModal() {
    const modal = new bootstrap.Modal(document.getElementById('quickBetModal'));
    
    // Carregar conteúdo do modal
    fetch(`{% url 'pools:detail' pool.slug %}?ajax=quick_bet`)
        .then(response => response.text())
        .then(html => {
            document.getElementById('quickBetContent').innerHTML = html;
        })
        .catch(error => {
            document.getElementById('quickBetContent').innerHTML = `
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Erro ao carregar partidas. Tente novamente.
                </div>
            `;
        });
    
    modal.show();
}

// Função para editar aposta
function editBet(matchId) {
    // Implementar lógica de edição de aposta
    const baseUrl = '{% url "pools:detail" pool.slug %}';
    window.location.href = baseUrl.replace('/detail/', `/bet/${matchId}/edit/`);
}

// Função para fazer nova aposta
function makeBet(matchId) {
    // Implementar lógica de nova aposta
    const baseUrl = '{% url "pools:detail" pool.slug %}';
    window.location.href = baseUrl.replace('/detail/', `/bet/${matchId}/`);
}

// Função para confirmar exclusão do bolão
function confirmDelete() {
    if (confirm('Tem certeza que deseja excluir este bolão? Esta ação não pode ser desfeita.')) {
        window.location.href = `{% url 'pools:detail' pool.slug %}`.replace('detail', 'delete');
    }
}

// Animação de entrada gradual para cards
function animateCards() {
    const cards = document.querySelectorAll('.timeline-card, .ranking-table tbody tr');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            card.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 50);
    });
}

// Executar animações quando as tabs forem mostradas
document.querySelectorAll('[data-bs-toggle="tab"]').forEach(function(tabEl) {
    tabEl.addEventListener('shown.bs.tab', function (event) {
        setTimeout(animateCards, 100);
    });
});

// Executar animação inicial
setTimeout(animateCards, 300);

// Auto-refresh para dados dinâmicos (opcional)
setInterval(function() {
    // Atualizar apenas se a página estiver visível
    if (!document.hidden) {
        // Implementar lógica de refresh automático se necessário
        console.log('Auto-refresh check...');
    }
}, 30000); // 30 segundos
</script>

{% endblock %}
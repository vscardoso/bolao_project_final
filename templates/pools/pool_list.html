{% extends 'base.html' %}
{% load static %}

{% block title %}Lista de Bolões | Bolão Online{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pools.css' %}">
{% endblock %}

{% block content %}
<!-- Skip to main content link -->
<a href="#pool-list-main" class="skip-link">Pular para lista de bolões</a>

<!-- Header -->
<header class="pool-list-header" role="banner">
    <div class="container">
        <h1 class="pool-list-title">
            <i class="fas fa-trophy me-3" aria-hidden="true"></i>Bolões Disponíveis
        </h1>
        <p class="pool-list-subtitle">
            Encontre e participe dos melhores bolões de futebol
        </p>
    </div>
</header>

<!-- Main Content -->
<main id="pool-list-main" class="container">
    <!-- Search Card -->
    <div class="pool-search-card">
        <form method="GET" class="pool-search-form" role="search" aria-label="Buscar bolões">
            <div class="flex-grow-1">
                <label for="search-input" class="visually-hidden">Buscar bolões</label>
                <input 
                    type="search" 
                    id="search-input"
                    name="search" 
                    class="form-control pool-search-input" 
                    placeholder="Buscar bolões por nome, descrição ou competição..."
                    value="{{ current_search }}"
                    aria-describedby="search-help"
                >
                <small id="search-help" class="visually-hidden">
                    Digite o nome ou descrição do bolão que você está procurando
                </small>
            </div>
            <button type="submit" class="btn btn-primary" aria-label="Buscar bolões">
                <i class="fas fa-search me-2" aria-hidden="true"></i>Buscar
            </button>
            <a href="{% url 'pools:create_wizard' %}" class="btn btn-success" aria-label="Criar novo bolão">
                <i class="fas fa-plus me-2" aria-hidden="true"></i>Criar Bolão
            </a>
        </form>
    </div>
    
    {% if pools %}
        <!-- Results Count -->
        <div class="mt-4 mb-3" role="status" aria-live="polite">
            <p class="text-muted">
                <strong>{{ pools|length }}</strong> bolão{{ pools|length|pluralize:" encontrado,s encontrados" }}
                {% if current_search %}
                    para "<em>{{ current_search }}</em>"
                    <a href="{% url 'pools:list' %}" class="ms-2 text-decoration-none" aria-label="Limpar busca e ver todos os bolões">
                        <small><i class="fas fa-times" aria-hidden="true"></i> Limpar busca</small>
                    </a>
                {% endif %}
            </p>
        </div>
        
        <!-- Pool Grid -->
        <div class="pool-grid" role="list" aria-label="Lista de bolões">
            {% for pool in pools %}
            <article class="pool-card" role="listitem">
                <!-- Card Header with Image -->
                <div class="pool-card-header">
                    {% if pool.pool_image %}
                        <img src="{{ pool.pool_image.url }}" alt="Imagem do bolão {{ pool.name }}" loading="lazy">
                    {% else %}
                        <i class="fas fa-futbol icon-4xl text-white-90" aria-hidden="true"></i>
                    {% endif %}
                    
                    <!-- Status Badge -->
                    <span class="pool-status-badge status-{{ pool.status }}" role="status">
                        {% if pool.status == 'open' %}
                            <i class="fas fa-play me-1" aria-hidden="true"></i>Aberto
                        {% elif pool.status == 'closed' %}
                            <i class="fas fa-lock me-1" aria-hidden="true"></i>Fechado
                        {% elif pool.status == 'finished' %}
                            <i class="fas fa-flag me-1" aria-hidden="true"></i>Finalizado
                        {% endif %}
                    </span>
                </div>
                
                <!-- Card Body -->
                <div class="pool-card-body">
                    <h2 class="pool-card-title">{{ pool.name }}</h2>
                    
                    {% if pool.description %}
                        <p class="pool-card-description">{{ pool.description|truncatechars:100 }}</p>
                    {% else %}
                        <p class="pool-card-description text-muted">
                            Bolão de {{ pool.competition.name|default:"Futebol" }}
                        </p>
                    {% endif %}
                    
                    <!-- Meta Information -->
                    <dl class="pool-meta">
                        <div class="pool-meta-item">
                            <dt class="visually-hidden">Participantes</dt>
                            <div class="pool-meta-icon">
                                <i class="fas fa-users" aria-hidden="true"></i>
                            </div>
                            <dd class="pool-meta-value">{{ pool.participant_count }}</dd>
                            <div class="pool-meta-label">Participantes</div>
                        </div>
                        
                        <div class="pool-meta-item">
                            <dt class="visually-hidden">Taxa de entrada</dt>
                            <div class="pool-meta-icon">
                                <i class="fas fa-dollar-sign" aria-hidden="true"></i>
                            </div>
                            <dd class="pool-meta-value">
                                {% if pool.entry_fee %}
                                    R$ {{ pool.entry_fee }}
                                {% else %}
                                    Grátis
                                {% endif %}
                            </dd>
                            <div class="pool-meta-label">Taxa</div>
                        </div>
                        
                        <div class="pool-meta-item">
                            <dt class="visually-hidden">Competição</dt>
                            <div class="pool-meta-icon">
                                <i class="fas fa-trophy" aria-hidden="true"></i>
                            </div>
                            <dd class="pool-meta-value">{{ pool.competition.name|default:"Futebol"|truncatechars:8 }}</dd>
                            <div class="pool-meta-label">Competição</div>
                        </div>
                    </dl>
                    
                    <!-- Actions -->
                    <div class="pool-actions">
                        <a href="{% url 'pools:detail' pool.slug %}" class="btn btn-info pool-btn-view flex-fill" aria-label="Ver detalhes do bolão {{ pool.name }}">
                            <i class="fas fa-eye me-2" aria-hidden="true"></i>Ver Detalhes
                        </a>
                        
                        {% if pool.status == 'open' %}
                            {% if user in pool.participants.all %}
                                <span class="btn pool-btn-participating flex-fill" role="status">
                                    <i class="fas fa-check me-2" aria-hidden="true"></i>Participando
                                </span>
                            {% elif pool.max_participants and pool.participant_count >= pool.max_participants %}
                                <span class="btn pool-btn-full flex-fill" role="status">
                                    <i class="fas fa-ban me-2" aria-hidden="true"></i>Lotado
                                </span>
                            {% else %}
                                <a href="{% url 'pools:join' pool.slug %}" class="btn btn-primary pool-btn-join flex-fill" aria-label="Participar do bolão {{ pool.name }}">
                                    <i class="fas fa-user-plus me-2" aria-hidden="true"></i>Participar
                                </a>
                            {% endif %}
                        {% else %}
                            <span class="btn pool-btn-unavailable flex-fill" role="status">
                                <i class="fas fa-lock me-2" aria-hidden="true"></i>Indisponível
                            </span>
                        {% endif %}
                    </div>
                </div>
            </article>
            {% endfor %}
        </div>
        
    {% else %}
        <!-- Empty State -->
        <div class="pool-empty-state" role="status">
            <i class="fas fa-search pool-empty-icon" aria-hidden="true"></i>
            <h2 class="h3">Nenhum bolão encontrado</h2>
            {% if current_search %}
                <p>Não encontramos bolões para sua busca "<strong>{{ current_search }}</strong>".</p>
                <p>Tente buscar por outros termos ou <a href="{% url 'pools:list' %}">ver todos os bolões</a>.</p>
            {% else %}
                <p>Ainda não há bolões disponíveis.</p>
                <p>Que tal ser o primeiro a criar um?</p>
                <div class="mt-4">
                    <a href="{% url 'pools:create_wizard' %}" class="btn btn-success btn-lg">
                        <i class="fas fa-plus me-2" aria-hidden="true"></i>Criar Primeiro Bolão
                    </a>
                </div>
            {% endif %}
        </div>
    {% endif %}
</main>
{% endblock %}